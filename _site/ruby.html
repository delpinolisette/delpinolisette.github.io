<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/ruby.html" />
<meta property="og:url" content="http://localhost:4000/ruby.html" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/ruby.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/"></a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/flask_py_translate_api.html">GoogleAPI Translate, Python, and Flask Tutprial</a><a class="page-link" href="/myblog/flask_py_translate_api.html">GoogleAPI Translate, Python, and Flask Tutprial</a><a class="page-link" href="/myblog/flask_start.html">Python and Flash Quick Start</a><a class="page-link" href="/flask_start.html">Python and Flash Quick Start</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <script type="text/javascript" async="" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p>Notice: These are personal notes for a course at my university on Web Development. I do not own any of this intellectual property, this is only used for personal education.</p>

<h3 id="table-of-contents">Table of Contents:</h3>
<ul>
  <li><a href="#lecture-7">Lecture 7</a></li>
  <li><a href="#lecture-8">Lecture 8</a></li>
  <li><a href="#lecture-9">Lecture 9</a></li>
</ul>

<h3 id="lecture-7"><strong>Lecture 7</strong></h3>
<ul>
  <li>Outline:
    <ul>
      <li>Deep Dive ActiveRecords</li>
    </ul>
  </li>
</ul>

<h4 id="web-framekwork-pipeline"><strong>Web Framekwork Pipeline:</strong></h4>
<ul>
  <li>Routes -&gt; Parsing -&gt; Controller -&gt; View
    <ul>
      <li>Step 1: define routes inside <code class="language-plaintext highlighter-rouge">config/routes.rb</code></li>
      <li>Step 2:create the <code class="language-plaintext highlighter-rouge">controller</code> file, with class and methods
        <ul>
          <li>has access to <strong><code class="language-plaintext highlighter-rouge">params</code> hash</strong> <a href="https://gorails.com/episodes/the-params-hash">params hash</a> + definition:
            <ul>
              <li>params hash is the collection of data that comes through with the http request</li>
              <li>forms, get request parameters, urls, gets data into the params hash</li>
            </ul>
          </li>
          <li>controller methods provide data</li>
        </ul>
      </li>
      <li>Step 3: Create the view folder and file
        <ul>
          <li>differences between <code class="language-plaintext highlighter-rouge">&lt;%= &gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;% %&gt;</code></li>
          <li>TODO - when you find out difference )i think one is embedded html</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="the-crud-pipeline"><strong>The CRUD Pipeline:</strong></h4>
<ul>
  <li>There is a dual representation of the site/data: Ruby vs. Database</li>
  <li><em>Models</em> are ruby representation of databse records
    <ul>
      <li>children classes of <code class="language-plaintext highlighter-rouge">ActiveRecord::Base</code></li>
      <li>methods inhereted from <code class="language-plaintext highlighter-rouge">ActiveRecord::Base</code></li>
      <li><a href="https://api.rubyonrails.org/classes/ActiveRecord/Base.html">ActiveRecord::Base</a></li>
      <li>provides CRUD API - TODO- what is the CRUD API?</li>
    </ul>
  </li>
  <li><em>Migrations</em> modify database schema
    <ul>
      <li>stored in <code class="language-plaintext highlighter-rouge">db/migrate</code></li>
      <li><a href="delpinolisette.github.io/img/migration_file_peek.PNG">looks like this</a></li>
      <li><a href="delpinolisette.github.io/img/migration_file_peek2.PNG">looks like this for PenninTouch clone</a></li>
      <li>creates tables</li>
      <li>adds and removes columns</li>
      <li>generates/updates a schema.rb file, <img src="delpinolisette.github.io/img/schema_peek.PNG" alt="schema.rb" /></li>
      <li>type <code class="language-plaintext highlighter-rouge">rails db:migrate</code> to start, can only be done once</li>
    </ul>
  </li>
</ul>

<h4 id="generating-a-model"><strong>Generating a Model</strong></h4>
<ul>
  <li>To generate a Model, run in root folder:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rails g model ModelName attr_name:attr_type</code></li>
      <li>ex: <code class="language-plaintext highlighter-rouge">rails g model Post tilte:string body:text</code></li>
    </ul>
  </li>
  <li>to destroy,
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rails destroy</code></li>
    </ul>
  </li>
</ul>

<h4 id="generators-for-migration"><strong>Generators for Migration</strong></h4>
<ul>
  <li>migration generators crete migration files which alter database record</li>
  <li><code class="language-plaintext highlighter-rouge">CreateXXXs</code> creates a table with table name <code class="language-plaintext highlighter-rouge">XXX</code> and specified columns</li>
  <li><code class="language-plaintext highlighter-rouge">AddXXXToYYYs</code> adds specified columns to table <code class="language-plaintext highlighter-rouge">YYY</code></li>
  <li><code class="language-plaintext highlighter-rouge">RemoveXXXFromYYs</code> will remove specified columns from <code class="language-plaintext highlighter-rouge">YYY</code> table</li>
  <li>ex1: <code class="language-plaintext highlighter-rouge">rails g migration CreatAuthors name:string bio:text</code>
    <ul>
      <li>makes table with Authors, which has a name and bio column</li>
    </ul>
  </li>
  <li>ex2: <code class="language-plaintext highlighter-rouge">rails g migration AddCategoryToPosts category:string</code>
    <ul>
      <li>adds Category column to Posts table</li>
    </ul>
  </li>
</ul>

<h4 id="commonly-used-data-types-for-models"><strong>Commonly Used Data Types for models</strong></h4>
<ul>
  <li>string</li>
  <li>text</li>
  <li>integer, float, decimal</li>
  <li>datetime, timestamp, time, date</li>
  <li>boolean</li>
  <li>references
    <ul>
      <li>creates reference to another table</li>
    </ul>
  </li>
</ul>

<h4 id="arel--complex-query-methods-for-models"><strong>Arel : Complex Query Methods for models</strong></h4>
<ul>
  <li>SQL is powerful</li>
  <li>ActiveRecord ORM is Ruby’s method of writing SQL</li>
  <li>ActiveRecord is built on top of Arel
    <ul>
      <li>Arel = Relational Algebra</li>
      <li>SQL Abstract Syntax Tree manager (AST)</li>
    </ul>
  </li>
</ul>

<h4 id="common-arels-relational-algebra"><strong>Common Arels (Relational Algebra)</strong></h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">User</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">name: </span><span class="s1">'Patrick'</span><span class="p">)</span>
<span class="c1">#=&gt; sends out query for all users names Patrick</span>
<span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">name: </span><span class="s1">'Patrick'</span><span class="p">)</span>
<span class="c1">#=&gt; sends out query for ONE user named Patrick</span>
<span class="no">User</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#=&gt; returns first two users, the order is ascending by id by default- first to last</span>
<span class="no">User</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="nb">id</span> <span class="ss">:desc</span><span class="p">)</span>
<span class="c1">#=&gt; returns all users last to first</span>
</code></pre></div></div>
<ul>
  <li>you can also chain commands, the order matters!:
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Post</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">view_count: </span><span class="o">&gt;</span><span class="mi">20</span><span class="p">).</span><span class="nf">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="nb">id</span> <span class="ss">:desc</span><span class="p">)</span>
<span class="c1">#=&gt; select from post table</span>
<span class="c1">#=&gt; where view_count is greater than 20</span>
<span class="c1">#=&gt; 5 users</span>
<span class="c1">#=&gt; in order from last to first</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="validations-check-before-you-commit"><strong>Validations: “Check before you commit!</strong></h4>
<ul>
  <li>what are the differences between Client-side and Server-side validations?
    <ul>
      <li>validations guard against invalid data commiting to database
        <ul>
          <li>ex: blank fields, incoreect format, making sure there isnt another identical entry (uniqueness)</li>
        </ul>
      </li>
      <li><em>Client-side validation</em> : enforced by client program
        <ul>
          <li>server isn’t sure who client is</li>
          <li>what if client is malicious? (a hack trying to commit to db)?</li>
        </ul>
      </li>
      <li><em>Server-side val</em> done by Rails is useful because it is invariant with respect to the client</li>
      <li>validation code in model files:</li>
      <li>you need to write it inside the model file</li>
    </ul>
  </li>
</ul>

<h4 id="simple-validations"><strong>Simple Validations</strong></h4>
<ul>
  <li>validations run right before save to db happens</li>
  <li><code class="language-plaintext highlighter-rouge">validates :column_name, criteria</code></li>
  <li>ex1: <code class="language-plaintext highlighter-rouge">presence</code> : field empty?</li>
  <li>ex2: <code class="language-plaintext highlighter-rouge">uniqueness</code> : is this value unique- is there another like it in db</li>
  <li>ex3: <code class="language-plaintext highlighter-rouge">length</code> : content length</li>
  <li>note: these validations work only because each model has an errors method, when something doesnt pass a validation it gets added to the error method of the model.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#=&gt; simple validations inside Post model file</span>
<span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="ss">:Base</span>
    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">prescence: </span><span class="kp">true</span>
    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span>
    <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">lenth: </span><span class="p">{</span><span class="ss">minimum: </span><span class="mi">5</span><span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="errors-method"><strong>Errors Method</strong></h4>
<ul>
  <li>every model instance has <code class="language-plaintext highlighter-rouge">errors</code> method</li>
  <li>if model did not pass a validation, <code class="language-plaintext highlighter-rouge">error</code> object added to model
    <ul>
      <li>model with non-empty (there’s something in it!) <code class="language-plaintext highlighter-rouge">errors</code> field is invalid to the database</li>
      <li>validations decide whether to add an <code class="language-plaintext highlighter-rouge">error</code> object to the <code class="language-plaintext highlighter-rouge">errors</code> field</li>
    </ul>
  </li>
  <li>view uses <code class="language-plaintext highlighter-rouge">errors</code> method and displays the <code class="language-plaintext highlighter-rouge">error.full_messages</code> for each <code class="language-plaintext highlighter-rouge">error</code></li>
  <li>note: when you create a model make sure that it saves successfully! if it doean’t, it encountered some invalid data.</li>
  <li>this method below makes sure to describe the error message(in <code class="language-plaintext highlighter-rouge">form_html_erb</code> for hw2):</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">% if </span><span class="vi">@user</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span><span class="sx">%&gt;
    &lt;div id= "error_explanation"&gt;</span>
      <span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="sx">%=@user.errors.count%&gt; errors prohibited this from...
      &lt;/h2&gt;
      &lt;ul&gt;
        &lt;&amp; @user.errors.full_messages.each do |msg|%&gt;
            &lt;li&gt;&lt;%=</span> <span class="n">msg</span> <span class="o">&amp;&gt;&lt;</span><span class="sr">/li&gt;
        &lt;% end %&gt;
      &lt;/u</span><span class="n">l</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</code></pre></div></div>

<h4 id="defining-custom-validations"><strong>Defining Custom Validations</strong></h4>
<ul>
  <li>Step 1: Define a method in the model file with this logic:
    <ul>
      <li>Step 1a: Check if the desired validation passes</li>
      <li>Step 1b: if it doesn’t pass,
        <ul>
          <li>add the column name as a symbol</li>
          <li>add the error message to the errors object</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Step 2: Pass the method as a symbol to <code class="language-plaintext highlighter-rouge">validate</code>  ex:
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#=&gt; example of a custom validation in User model file</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validate</span> <span class="ss">:penn_email</span>
  <span class="k">def</span> <span class="nf">penn_email</span>
      <span class="k">unless</span> <span class="n">email</span><span class="p">.</span><span class="nf">include?</span> <span class="s1">'upenn.edu'</span>
          <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="s1">'it is not a Penn email'</span><span class="p">)</span>
      <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="association-lvl-1--one-to-many"><strong>Association: Lvl 1- One to Many</strong></h4>
<ul>
  <li><em>One to Many Association</em>: when one model_A may logically have many model_B’s, but the reverse is not true:
    <ul>
      <li>ex: a <code class="language-plaintext highlighter-rouge">Post</code> has many <code class="language-plaintext highlighter-rouge">Comments</code>, but not the other way around</li>
      <li>ex: a <code class="language-plaintext highlighter-rouge">Book</code> has many <code class="language-plaintext highlighter-rouge">Chapters</code>, but not the other way around</li>
    </ul>
  </li>
  <li>counterexamples:
    <ul>
      <li>ex: a <code class="language-plaintext highlighter-rouge">Teacher</code> has many <code class="language-plaintext highlighter-rouge">Students</code>, but the reverse is also true</li>
      <li>ex: a <code class="language-plaintext highlighter-rouge">Shop</code> has many <code class="language-plaintext highlighter-rouge">Customers</code>, but the reverse is also true</li>
    </ul>
  </li>
</ul>

<h4 id="implementation-in-database"><strong>Implementation in Database</strong></h4>
<ul>
  <li>Step 1: Initialize <code class="language-plaintext highlighter-rouge">Posts</code> table and <code class="language-plaintext highlighter-rouge">Comments</code> table</li>
  <li>Step 2: Declare the association:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Comments</code> table has columnn that says which <code class="language-plaintext highlighter-rouge">Post</code> record the <code class="language-plaintext highlighter-rouge">Comment</code> redord belongs to
        <ul>
          <li><em>foreign key</em>: reference to <em>primary key</em> in different table
            <ul>
              <li>ex: the column in <code class="language-plaintext highlighter-rouge">Comments</code> that connects the post record and comment record</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>new CRUD available:
    <ul>
      <li>create a comment for a post</li>
      <li>find all comments belonging to a post</li>
      <li>find the post a comment belongs to</li>
    </ul>
  </li>
</ul>

<h4 id="dual-implementation-in-rubyrails"><strong>Dual Implementation in Ruby/Rails</strong></h4>
<ul>
  <li>this is where associations implementations take place, abstracted away by ruby.</li>
  <li>through ActiveRecord ORM
    <ul>
      <li>Step 1: use generator for <code class="language-plaintext highlighter-rouge">Post</code> model (in previous ex)</li>
      <li>Step 2: use generator for <code class="language-plaintext highlighter-rouge">Comments</code> model
        <ul>
          <li>add <code class="language-plaintext highlighter-rouge">post:references</code> as a column (needs to be plural)</li>
        </ul>
      </li>
      <li>Step 3: <code class="language-plaintext highlighter-rouge">rails db:migrate</code></li>
      <li>Step 4: in <code class="language-plaintext highlighter-rouge">Comment.rb</code> model file, add <code class="language-plaintext highlighter-rouge">belong_to :user</code></li>
      <li>Step 5: in <code class="language-plaintext highlighter-rouge">Post.rb</code> model file under class declaration add <code class="language-plaintext highlighter-rouge">has_many :comments, dependent: destroy</code>
        <ul>
          <li>why add <code class="language-plaintext highlighter-rouge">dependent: destroy</code>?</li>
          <li>because when you destroy the post you will destroy all the comments associated with that post.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>new CRUD available:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<span class="c1">#=&gt;get post with id 1</span>

<span class="vi">@new_comment</span> <span class="o">=</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> 
<span class="c1">#=&gt;equiv to post.new?</span>
<span class="vi">@new_comment</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="s1">'Comment for post 1'</span>
<span class="vi">@new_comment</span><span class="p">.</span><span class="nf">save</span> 

<span class="c1">#=&gt;alternative comment creation:</span>
<span class="vi">@new_comment</span> <span class="o">=</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span><span class="ss">body: </span><span class="s1">'Comment for post 1'</span><span class="p">})</span>

<span class="c1">#=&gt;find all comments belonging to a post:</span>
<span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="vi">@comments</span> <span class="o">=</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">comments</span>

<span class="c1">#=&gt;find the post that a comment belongs to:</span>
<span class="vi">@comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="vi">@post</span> <span class="o">=</span> <span class="vi">@comment</span><span class="p">.</span><span class="nf">post</span>

<span class="c1"># recall that :</span>
<span class="vi">@post</span><span class="p">.</span><span class="nf">comment</span><span class="p">.</span><span class="nf">post</span> <span class="o">==</span> <span class="vi">@post</span>
</code></pre></div></div>

<h4 id="association-lvl2-many-to-many"><strong>Association Lvl2: Many to Many</strong></h4>
<ul>
  <li>happens when two models can be associated with multiple instances of each other
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Students</code> and <code class="language-plaintext highlighter-rouge">Courses</code></li>
      <li><code class="language-plaintext highlighter-rouge">Houses</code> and <code class="language-plaintext highlighter-rouge">Owners</code></li>
    </ul>
  </li>
  <li>A model can have many to many association with iteself!:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Users</code> can have many <code class="language-plaintext highlighter-rouge">Users</code> as friends</li>
    </ul>
  </li>
</ul>

<h4 id="wrong-implementation-in-database"><strong>Wrong Implementation in Database:</strong></h4>
<ul>
  <li>Add <em>foreign keys</em> to both tables
    <ul>
      <li>you run into a duplicate <em>primary key</em> issue</li>
      <li>you can fix with RID (ref id?), but still redundant !</li>
      <li><img src="delpinolisette.github.io/img/wrong_many_to_many.PNG" alt="example" /></li>
    </ul>
  </li>
</ul>

<h4 id="correct-implementation-in-database"><strong>Correct Implementation in Database</strong></h4>
<ul>
  <li>Use three tables, the third one is to keep records</li>
  <li><img src="delpinolisette.github.io/img/right_many_to_many.PNG" alt="example" /></li>
  <li>notice <code class="language-plaintext highlighter-rouge">course_id</code> is foreign key and <code class="language-plaintext highlighter-rouge">student_id</code> is reference?</li>
</ul>

<h4 id="implementation-of-many-to-many-in-rubyrails"><strong>Implementation of Many to Many in Ruby/Rails</strong></h4>
<ul>
  <li>Step 1: generate <code class="language-plaintext highlighter-rouge">Course</code> and <code class="language-plaintext highlighter-rouge">Student</code> model migration like above examples
    <ul>
      <li>no <code class="language-plaintext highlighter-rouge">reference</code> column this time!</li>
    </ul>
  </li>
  <li>Step 2: <code class="language-plaintext highlighter-rouge">rails g Model Registration Course:references Student:references</code></li>
  <li>Step 3: in <code class="language-plaintext highlighter-rouge">Course.rb</code> model file, write
    <ul>
      <li><code class="language-plaintext highlighter-rouge">has_many :registrations, dependent: :destroy</code> #why do we write this?</li>
      <li><code class="language-plaintext highlighter-rouge">has_many :students, through: registrations</code></li>
    </ul>
  </li>
  <li>Step 4: do the same for the <code class="language-plaintext highlighter-rouge">Student.rb</code> model file</li>
  <li>Step 5: and in the <code class="language-plaintext highlighter-rouge">Registration.rb</code> model file (join table)
    <ul>
      <li><code class="language-plaintext highlighter-rouge">belongs_to :student</code></li>
      <li><code class="language-plaintext highlighter-rouge">belongs_to :course</code></li>
    </ul>
  </li>
</ul>

<h4 id="forms-making-post-requests"><strong>Forms: Making POST Requests</strong></h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;form&gt;</code>s are html elements that make POST requests for a bundle of data</li>
  <li>Rails erb use <code class="language-plaintext highlighter-rouge">form_with</code> to create the HTML forms: make sure to include:
    <ul>
      <li>destination url</li>
      <li>whether the data is associated with a model</li>
      <li>field names</li>
      <li>field input type</li>
      <li>display name of fields</li>
    </ul>
  </li>
  <li>(field name, value) become key-val pairs</li>
  <li>URL vs Model (form_with):</li>
  <li><code class="language-plaintext highlighter-rouge">form_with</code> with a url becomes <em>url params</em>:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= form_with url: '/login' do |form| &amp;&gt;
    &lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:email</span> <span class="o">%&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= form.text_field :email %&gt;
    &lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span><span class="sx">%&gt;
&lt;&amp; end &amp;&gt;</span> 
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">form_with</code> with a model becomes <em>body params</em>:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= form_with model: @user do |form| &amp;&gt;
    &lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:email</span> <span class="o">%&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= form.text_field :email %&gt;
    &lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span><span class="sx">%&gt;
&lt;&amp; end &amp;&gt;</span> 
</code></pre></div></div>

<ul>
  <li>why bother making the distinction?
    <ul>
      <li><em>body params</em> need to be <code class="language-plaintext highlighter-rouge">permitted</code> to prevent mass assignment attacks.</li>
      <li><em>url params</em> do not need to <code class="language-plaintext highlighter-rouge">permitted</code>.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">form_with_model</code> are database critical
    <ul>
      <li>always check what data the form is sending! need to whiteliest certain fields
        <ul>
          <li>whitelisting stops bad data from being commited to the databse.</li>
          <li><code class="language-plaintext highlighter-rouge">params.require(:post).permit(:title, :content)</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="designing-forms-log-in-form"><strong>Designing Forms: Log In Form</strong></h4>
<ul>
  <li>making a login form, what do I need?
    <ul>
      <li>S1: need user email + user password
        <ul>
          <li>this decides field name, type, and label.</li>
        </ul>
      </li>
      <li>S2: is the form associated with a model?
        <ul>
          <li>if yes: use <code class="language-plaintext highlighter-rouge">form_with model</code></li>
          <li>if not: use <code class="language-plaintext highlighter-rouge">form_with url</code></li>
        </ul>
      </li>
      <li>what end point does this form <code class="language-plaintext highlighter-rouge">POST</code> to?
        <ul>
          <li>this posts to <code class="language-plaintext highlighter-rouge">/login</code> with the data:</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="ss">email: </span><span class="s1">'[email_field_value]'</span>
    <span class="ss">password: </span><span class="s1">'[password_field_value]'</span>
<span class="p">}</span>
</code></pre></div></div>
<p>TODO: FINISH LEC 7</p>

<hr />

<h3 id="lecture-8"><strong>Lecture 8</strong></h3>
<ul>
  <li>Demo Lecture.</li>
  <li>Outline:
    <ul>
      <li>Scaffold Generator</li>
      <li>Arel</li>
      <li>Validation</li>
      <li>One to Many</li>
      <li>Many to Many</li>
    </ul>
  </li>
</ul>

<h4 id="scaffold-generator"><strong>Scaffold Generator</strong>:</h4>
<ul>
  <li>Basucally a buffed up model generator.</li>
  <li>What does the scaffold generator generate?
    <ul>
      <li>model/migration file</li>
      <li>controller file + its implementation</li>
      <li>entire view folder - all erbs are there!</li>
      <li>all RESTful routes
        <ul>
          <li>wow this is a strong boy</li>
          <li>so purpose of HW2 was to practice routing, all of it can be done with this one line
            <ul>
              <li>there are differences:</li>
              <li>(1) instead of explicitly defining routes in <code class="language-plaintext highlighter-rouge">routes.rb</code>, only writes <code class="language-plaintext highlighter-rouge">resources: posts</code>, which are all CRUD resources/ seven RESTful CRUD routes.</li>
              <li>(2) usage of before action in <code class="language-plaintext highlighter-rouge">posts_controller.rb</code>.
                <ul>
                  <li>it just says, before running any method of <code class="language-plaintext highlighter-rouge">PostsController</code>, it will run <code class="language-plaintext highlighter-rouge">set_post</code> to find the post in question.</li>
                </ul>
              </li>
              <li>(3) usage of named routes/ route helper methods
                <ul>
                  <li>seen in <code class="language-plaintext highlighter-rouge">posts_controller.rb</code>, alias for RESTful routes used.</li>
                  <li>also in <code class="language-plaintext highlighter-rouge">inex.html.erb</code>, there are link-to’s that are sent to the alias of the RESTful route.
                    <ul>
                      <li>ex: instead of <code class="language-plaintext highlighter-rouge">link_to ... "/posts/#{post.id}/edit"</code>, it uses <code class="language-plaintext highlighter-rouge">link_to 'Edit', edit_post_path(post)</code></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>How to use? check it out:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#=&gt; to generate:</span>
<span class="n">rails</span> <span class="n">g</span> <span class="n">scaffold</span> <span class="no">Post</span> <span class="n">title</span><span class="ss">:string</span> <span class="n">content</span><span class="ss">:text</span>
<span class="c1">#=&gt; to destroy:</span>
<span class="n">rails</span> <span class="n">destroy</span> <span class="n">scaffold</span> <span class="no">Post</span>
</code></pre></div></div>

<h4 id="scaffold-generator-demo"><strong>Scaffold Generator Demo</strong></h4>
<ul>
  <li>S1: navigate to your desired dir and rails new a new project</li>
  <li><code class="language-plaintext highlighter-rouge">rails 5.2.4 new scaffold_blog</code></li>
  <li>cd into <code class="language-plaintext highlighter-rouge">scaffold_blog</code> and run <code class="language-plaintext highlighter-rouge">rails s -b 0.0.0.0</code> to boot server, <code class="language-plaintext highlighter-rouge">localhost:3000</code> is up.</li>
  <li>S2: use scaffold generator by <code class="language-plaintext highlighter-rouge">rails g scaffold Post title:string content:text</code></li>
  <li>S3: Run <code class="language-plaintext highlighter-rouge">rails db:migrate</code></li>
  <li>S4: cd into <code class="language-plaintext highlighter-rouge">scaffold_blog</code> and run <code class="language-plaintext highlighter-rouge">rails s -b 0.0.0.0</code> to boot server, <code class="language-plaintext highlighter-rouge">localhost:3000/posts</code> is up.</li>
</ul>

<h4 id="arel-demo"><strong>Arel Demo</strong></h4>
<ul>
  <li>TODO</li>
</ul>

<h4 id="validations-demo"><strong>Validations Demo</strong></h4>
<ul>
  <li>here we generated a new project and scaffold generated <code class="language-plaintext highlighter-rouge">rails g scaffold User first_name:string last_name:string email:string</code></li>
  <li>in the model file,
    <ul>
      <li>makes sure <code class="language-plaintext highlighter-rouge">first_name, last_name</code> not blank:</li>
      <li><code class="language-plaintext highlighter-rouge">validates :first_name, :last_name, presence: true</code></li>
      <li>makes sure length of email is valid, it’s unique, and it exists:</li>
      <li><code class="language-plaintext highlighter-rouge">validates :email, presence: true, uniqueness: true, ;length: {minimum: 5}</code></li>
    </ul>
  </li>
  <li>in the model file, let’s make custom validations:
    <ul>
      <li>begin with <code class="language-plaintext highlighter-rouge">private</code> keyword, see code:</li>
      <li>use <code class="language-plaintext highlighter-rouge">validate</code> keyword for custom validations, <code class="language-plaintext highlighter-rouge">validates</code> for simple ones.</li>
      <li>after you are done, boot up the server and test to make sure your validations are working.
        <ul>
          <li>run <code class="language-plaintext highlighter-rouge">rails db:migrate</code> to apply changes.</li>
          <li>play around to make sure error messages get added with invalid input</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Class</span> <span class="no">User</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="ss">validates: </span><span class="n">first_name</span><span class="p">,</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">:presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span><span class="ss">minimum: </span><span class="mi">5</span><span class="p">}</span>
  <span class="n">validate</span> <span class="ss">:first_name_capitalized</span><span class="p">,</span> <span class="ss">:last_name_capitalized</span>

<span class="c1">#=&gt; custom validations:</span>
  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">first_name_capitalized</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:first_name</span><span class="p">,</span> <span class="s2">"must be capitalized"</span><span class="p">)</span> <span class="k">if</span> <span class="n">first_name</span> <span class="o">&amp;&amp;</span> <span class="n">first_name</span><span class="p">.</span><span class="nf">capitalize!</span>
    <span class="c1">#=&gt; first_name is boolean as to whether its there or blank</span>
    <span class="c1">#=&gt; first_name.capitalize is boolean true if capitalized</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">last_name_capitalized</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:last_name</span><span class="p">,</span> <span class="s2">"must be capitalized"</span><span class="p">)</span> <span class="k">if</span> <span class="n">last_name</span> <span class="o">&amp;&amp;</span> <span class="n">last_name</span><span class="p">.</span><span class="nf">capitalize!</span>
  <span class="k">end</span>
<span class="k">end</span> 
</code></pre></div></div>

<h4 id="associations-demo"><strong>Associations Demo</strong></h4>
<ul>
  <li><strong>One to Many Association Sub-Demo</strong>:</li>
  <li>Here I scaffold generate a Post model and Comment model, and establish the association that a Post has many Comments, but a Comment does not have many Posts.</li>
  <li>as always, generate your <code class="language-plaintext highlighter-rouge">Post</code> model
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rails g scafold Post title:string content:text</code></li>
    </ul>
  </li>
  <li>the one model is agnostic of the existence of many model.
    <ul>
      <li>however, when you generate comment, make sure to establish <code class="language-plaintext highlighter-rouge">post:references</code> to have a post column of type reference, since there are many comments to one post.</li>
      <li><code class="language-plaintext highlighter-rouge">rails g scaffold Comment content:string post:references</code></li>
    </ul>
  </li>
  <li>but you are not done yet, need to edit model files.
    <ul>
      <li>S1: nav to <code class="language-plaintext highlighter-rouge">post.rb</code></li>
    </ul>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
    <span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span> <span class="n">dependent</span><span class="ss">:destroy</span> 
    <span class="c1">#=&gt; dep destroy destroys all associated comments when the post is deleted</span>
  <span class="k">end</span> 
</code></pre></div>    </div>

    <ul>
      <li>S2: nav to <code class="language-plaintext highlighter-rouge">comment.rb</code>, make sure there is an appropriate <code class="language-plaintext highlighter-rouge">belong_to</code></li>
    </ul>
  </li>
  <li>S2: Test your associations in <code class="language-plaintext highlighter-rouge">rails c</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rails c</code></li>
      <li>create a new post</li>
      <li><code class="language-plaintext highlighter-rouge">@post = Post.create(title : "hello", content: "first post!")</code></li>
      <li>create a comment associated with the post:</li>
      <li>way 1: <code class="language-plaintext highlighter-rouge">@comment = Comment.new</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">@comment.content = "great writing"</code></li>
          <li>how to associate ?</li>
          <li>basic way : <code class="language-plaintext highlighter-rouge">@comment.post_id = @post.id</code>
            <ul>
              <li>preffered rails method: <code class="language-plaintext highlighter-rouge">@comment.post = @post</code>
                <ul>
                  <li>what’s happening under the hood?</li>
                  <li>the <code class="language-plaintext highlighter-rouge">.post</code> method is not a method of <code class="language-plaintext highlighter-rouge">Comment</code> model file.</li>
                  <li>but since we declared in scaffold generation, and verified in the model file, that we have a comment <code class="language-plaintext highlighter-rouge">belongs_to</code>, we can use that method.</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>check that <code class="language-plaintext highlighter-rouge">@comment.save</code> works.</li>
        </ul>
      </li>
      <li>way 2: <code class="language-plaintext highlighter-rouge">@comment = @post.comments.build</code>
        <ul>
          <li>this is essentially the same as <code class="language-plaintext highlighter-rouge">@comment = Comment.new</code> except by default it is providing a post id for the current <code class="language-plaintext highlighter-rouge">@post</code></li>
          <li>then just set content <code class="language-plaintext highlighter-rouge">@comment.content = "second comment"</code></li>
          <li><code class="language-plaintext highlighter-rouge">@comment.save</code> should be true</li>
          <li>now check save by looking at <code class="language-plaintext highlighter-rouge">@post.comments</code></li>
          <li>check contents of comment by <code class="language-plaintext highlighter-rouge">@comment.post</code></li>
        </ul>
      </li>
      <li>way 3: how to do everything in one line?
        <ul>
          <li><code class="language-plaintext highlighter-rouge">@comment3 =  Comment.create({content: "comment3", post:@post})</code></li>
          <li>check by <code class="language-plaintext highlighter-rouge">@post.comments</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>the blog with posts and comments as we’ve built it currently requires nested resources to fully work - the routes in <code class="language-plaintext highlighter-rouge">routes.rb</code> are incorrect.
    <ul>
      <li>comments routes should be nested under posts routes.</li>
    </ul>
  </li>
  <li>also in the controller, comments controller needs to find its post first</li>
  <li>should be something like:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="vi">@comment</span>  <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li><strong>Many to Many Association Sub-Demo</strong></li>
  <li>nav to your directory, generate your models with appropriate generators.
    <ul>
      <li>create <code class="language-plaintext highlighter-rouge">Students</code> and <code class="language-plaintext highlighter-rouge">Courses</code> models agnostic of each other, then create a <code class="language-plaintext highlighter-rouge">Registrations</code> object that connects them by holding references between them.</li>
      <li><code class="language-plaintext highlighter-rouge">rails g scaffold Course title:string desc:test code:integer</code></li>
      <li><code class="language-plaintext highlighter-rouge">rails g scaffold Student first_name:string last_name</code>
        <ul>
          <li>default type is string, you can omit (nice).</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">rails g scaffold Registrations course:references student:references</code></li>
      <li><code class="language-plaintext highlighter-rouge">rails db:migrate</code></li>
    </ul>
  </li>
  <li>now further declare the associations between <code class="language-plaintext highlighter-rouge">STudent</code> and <code class="language-plaintext highlighter-rouge">Course</code> through the model files using <code class="language-plaintext highlighter-rouge">Registrations</code>.
    <ul>
      <li>S1: in <code class="language-plaintext highlighter-rouge">student.rb</code>:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">has_many :registrations dependent: :destroy</code></li>
          <li><code class="language-plaintext highlighter-rouge">has_many :courses, through: :registration</code></li>
        </ul>
      </li>
      <li>S2: in <code class="language-plaintext highlighter-rouge">courses.rb</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">has_many :registrations dependent: :destroy</code></li>
          <li><code class="language-plaintext highlighter-rouge">has_many :students, through: :registration</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>how do you test this? boot up <code class="language-plaintext highlighter-rouge">rails c</code>
    <ul>
      <li>create a course <code class="language-plaintext highlighter-rouge">@course = Course.create({title: "Ruby course", desc: "course on web dev", code:196})</code></li>
      <li>create a student <code class="language-plaintext highlighter-rouge">@student = Student.create({first_name: "Patrick", last_name: "Puppy"})</code></li>
      <li>shovel that <code class="language-plaintext highlighter-rouge">student</code> into the students array of <code class="language-plaintext highlighter-rouge">course</code></li>
      <li><code class="language-plaintext highlighter-rouge">@course.students &lt;&lt; @student</code></li>
      <li>test <code class="language-plaintext highlighter-rouge">@course.students</code> to see if Patrick is there.</li>
      <li>test <code class="language-plaintext highlighter-rouge">@student.courses</code> to see if the course is there.</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="lecture-9">Lecture 9</h3>
<ul>
  <li>Outline:
    <ul>
      <li>Route Helpers</li>
      <li>Resources</li>
      <li>Nested Resources</li>
      <li>Form/FOrm Helpers</li>
    </ul>
  </li>
  <li>Skipped ahead a bunch make sure to finish the lecture
    <h4 id="how-sessions-work"><strong>How Sessions Work</strong></h4>
  </li>
  <li>HTTP requests are stateless
    <ul>
      <li>the server doesnt memorize the historic request information, not enough space.</li>
    </ul>
  </li>
  <li>note: clients == web browser, user == a user record in the database
    <ul>
      <li>so sessions associate a client and a user instance.</li>
      <li>you can usually think of a clinet as a person, since people tend to use their personal browser.</li>
    </ul>
  </li>
  <li>What are Sessions?
    <ul>
      <li>Sessions are hash data structures the represent all the request info.
        <ul>
          <li>who is the user</li>
          <li>what time was the request made, etc.</li>
        </ul>
      </li>
      <li>server can only hold limited amount of sessions</li>
      <li>sessions stored in <code class="language-plaintext highlighter-rouge">session_store</code></li>
      <li>the key for a session is a <code class="language-plaintext highlighter-rouge">session_id</code>
        <ul>
          <li>cookies pass in a <code class="language-plaintext highlighter-rouge">session_id</code></li>
          <li>cookies stored by the user browser.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Coffeeshop Analogy:
    <ul>
      <li>you order a lattee from a shop</li>
      <li>two days later, you come back and say you want to order the last item you ordered</li>
      <li>…so what was it???</li>
      <li>with sessions:
        <ul>
          <li>order a latte from a coffe shop</li>
          <li>shop keeps <code class="language-plaintext highlighter-rouge">uid: [last_order: latte]</code> on a peice of paper, and gives you the <code class="language-plaintext highlighter-rouge">uid</code></li>
          <li>two days later, come back with the <code class="language-plaintext highlighter-rouge">uid</code> and say you want to order the last thing you ordered.</li>
          <li></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name"></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
